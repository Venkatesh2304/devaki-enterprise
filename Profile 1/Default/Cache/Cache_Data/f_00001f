var maxRowCount = 0;
var viewName;
var attrIdVal;
var freezeMaxCount = false;
var noOfHiddenColumnsFromFirst = 1;
var popTableJsonObject;
var scrlDown = false;
var ajaxConfirm = '1';
var onLoad = false;
var pageload = '0';
var pageCount = 200;
var textLengthToSearch = 0;
var keycode, nextSelectOption = 0, searchString = '', numString="";
var searchFocus = '';
//Added to display/hide pagination/search functionality in screen.
var displayPaginationHeader = true;
var displaySearchFooter = true;
var ajaxSearchRequest = null;
var pagination_scroll_change_flag = false;
var pagination_scroll_change_pageNo = 0;

/*Scroll Down, If variable is true then Existing Record not to be Removed else Existing Record to be Removed and Current Record will be Added*/
var castScrollUpDown = true;
/*Selected Row all column Values to be stored in Json Object*/
var addJsonObjValue = true;
var popupJsonObj = [];
/*Auto Width and Tool-Tip*/
var tblAutoWidth = true;
/*Scroll Down Issue Fixed*/
var pageFirstLoad = 0;
//Checking screen is editable or non-editable. 
var additionSearchCriteria = '';
//to avoid multiple invocation of pagination popup
var pagination_isProcessing = false;

var pagination_for_multi_selection_flag = false;
var pagination_for_multi_select_compare_col_index = 0;
var pagination_for_multi_select_checked_list = [];
var pagination_for_multi_select_array_all_data = [];
var pagination_for_multi_select_result_data = [];

var pagination_for_multi_select_all_records = [];
//used for opening pagination in product column key press event
var open_popup_key = {
		charTyped: '',
		isTriggered: false,
		popupTrigger: null,
		defaultColumnSearch: null,
		firstColumn: null,
		firstColumnIdx: null,
		isFirstColumnEnable: false,
		triggeredOnSearchOn: false
	};

function checkPopScreenAccess(){
	if(editAllowed){
		return true;
	}else{
		return false;
	}
}
function loadPaginationPopup_afterLoad(){
	pagination_hideLoadingImage();
	pagination_isProcessing = false;
	$('#open-pop-up-box').trigger("open-pop-up-loaded"); 
}

function loadPaginationPopup_beforeLoad(){
	pagination_isProcessing = true;
	pagination_displayLoadingImage();
}

function loadPaginationPopup(elementId, popupParams) {
	if (!pagination_isProcessing) {
		loadPaginationPopup_beforeLoad();
		setTimeout(function() {
			loadPaginationPopup_implementaion(elementId, popupParams);
		}, 0);
	}
}

function loadPaginationPopup_implementaion(elementId, popupParams){
	// Input text should have id to identify input text.
	open_popup_key.firstColumn = null;
	open_popup_key.firstColumnIdx = null;
	open_popup_key.isFirstColumnEnable = false;
	nextSelectOption = 0;
	searchString = '';
	numString = "";
	attrIdVal = elementId;
	$('.inputSr').focus();
	var pageNumber = 1;
	pageCount = 200;
	if(checkPopScreenAccess()){
		popTableJsonObject = provideFieldAndTableInformation();
		if(tblAutoWidth == true){
			$('#pop-up-table').attr('class',"tbl-fixed-headers-pagination "+attrIdVal+"");
		}else{
			$('#pop-up-table').attr('class',"tbl-fixed-headers-pagination "+attrIdVal+"");
		}
		$('#pop-up-box-title').text(popTableJsonObject[attrIdVal][0].title);
		viewName = popTableJsonObject[attrIdVal][0].viewName;
		$('#pop-up-table thead').html('');
		$('#pop-up-table tbody').html('');
		$(".inputSr").val('');
		var searchText = $(".inputSr").val();
		var searchOn = '';
		if(open_popup_key.isTriggered && open_popup_key.defaultColumnSearch) {
			searchOn = open_popup_key.defaultColumnSearch;
			$("#inputSrId").val(open_popup_key.charTyped);
		}
		if(popupParams && popupParams.id) {
			var whichColumnToSearch = $('#searchMaintenance-' + popupParams.id.toLowerCase()).val();
			if(whichColumnToSearch) {
				if(popupParams[whichColumnToSearch]) {
					searchOn = popupParams[whichColumnToSearch];
					open_popup_key.isFirstColumnEnable = true;
					open_popup_key.firstColumn = searchOn;
					open_popup_key.defaultColumnSearch = searchOn;
				}
			}
		}
		
		$("#selectOnId").focus();
		var targetJSON = getPaginationParams(getPaginationJasonParam(attrIdVal, "", pageNumber, searchOn, viewName));
		freezeMaxCount = false;
		onLoad = true;
		loadTableTdBody(pageNumber, targetJSON);
		if(pagination_for_multi_selection_flag){
		    loadTableTdBody(pageNumber, targetJSON,true);
		}
		//table fixed header 
		$('#minus-img-id').find('img').hide();
		$('#open-pop-up-box #add-search-fields-div').hide();
		$('#add-img-id').find('img').show();
		$("#pagination-multi_select_checkbox-all").prop("checked",false);
	}
		loadPaginationPopup_afterLoad();
}

// pagination spinner
function pagination_displayLoadingImage() {
	if ($("#ajax-loaded-id").length == 0) {
		var loadHTML = "<div id='ajax-loaded-id'>";
		loadHTML += "<div class='popup-overlay'></div>";
		loadHTML += "<div class='ajax-loader-to-display' style='display: block;'></div>";
		$("body").append(loadHTML);
	} else {
		$("#ajax-loaded-id").show();
	}

}

function pagination_hideLoadingImage() {
	if ($("#ajax-loaded-id").length > 0) {
		$("#ajax-loaded-id").remove();
	}
}


//Open pop-up screen on mouse double click and generate Table HTML dynamically.
$(".open-pop-up").on("dblclick", function() {
	attrIdVal = $(this).attr('id');
	loadPaginationPopup(attrIdVal);
}); 

//Loading table data from database............
function loadTableTdBody(pageNumber, targetJSON,selectAllFlag){
	//Get URL for AJAX call here.......
	if(editAllowed == true){
		callControllerToLoadTableBody(pageNumber, targetJSON,selectAllFlag);
	}
}

function additionalSearchCriteria(){
	var add_search_text = ' ';
	var add_search_on = ' ';
	var add_search_type = ' ';
	if(!$('#add-img-id').find('img').is(':visible') && $('#open-pop-up-box #add-search-fields-div').is(':visible')){
		add_search_text = $.trim($('#add-input-sr-id').val());
		add_search_on = $.trim($('select#add-select-on-id option:selected').val());
		add_search_type = $.trim($('select#add-select-type-id option:selected').val());
	}
	var addSearchCrObj = {"additionalColumnToSearch" : add_search_on, "additionalColumnSearchText" : add_search_text, "additionalTextSearchType" : add_search_type};
	return addSearchCrObj;
}


function getControllerParamsJson(targetJSON) {
	var outputJson = {
			'jasonParam': targetJSON.jasonParam,
			'additionalJsonParam': additionalSearchCriteria(),
			'columnSearchText': $.trim($(".inputSr").val())
	};
	
	if(targetJSON.hasOwnProperty('orderBy')) {
		outputJson.orderBy = targetJSON.orderBy;
	}
	
	if(targetJSON.hasOwnProperty('jsonObjWhereClause')) {
		outputJson.jsonObjWhereClause = targetJSON.jsonObjWhereClause;
	}
	
	if(targetJSON.hasOwnProperty('dynamicWhere')) {
		outputJson.dynamicWhere = targetJSON.dynamicWhere;
	}
		
	return outputJson;
}

//AJAX call for calling controller and fetching data into pop screen body.
function callControllerToLoadTableBody(pageNumber, targetJSON, selectAllFlag){
	if( typeof selectAllFlag != "undefined" && selectAllFlag ){
	    targetJSON.jasonParam.pageSize = 1000000;
	}
	$('#display-message').text("");
	var url = $('#pagination-contextPath').val() + '/app/paginationController/getPopScreenData';
	if(targetJSON.hasOwnProperty('url'))  {
		url = targetJSON.url;
	}
	if(ajaxSearchRequest != null && ajaxSearchRequest) 
		try{ajaxSearchRequest.abort();} catch(e){} 
	ajaxSearchRequest = $.ajax({
		method : 'POST',
		url: url,
		data: JSON.stringify(getControllerParamsJson(targetJSON)),
		cache: false,
		contentType: 'application/json',
		async: false,
		success: function (dataListArray) {
			if(dataListArray != ''){
				if(scrlDown == false){
					if( typeof selectAllFlag != "undefined" && selectAllFlag ){
					    pagination_for_multi_select_all_records = dataListArray[0];
					}else{
					    populateDataIntoTableBody(dataListArray);
					}
					
					pagination_scroll_change_flag = false;
					ajaxConfirm = '1';
					if(onLoad){
						if(dataListArray[1][0] > 1000){ // Configurable page wise........
							textLengthToSearch = 2;
						}else{
							textLengthToSearch = 0;
						}
					}
					if($('#pop-up-table tbody tr').length === 0 && !open_popup_key.isTriggered){
						$('#pop-up-table tbody tr').html("");
						$('#display-message').text("No Record Found");
					    $('#display-message').removeClass("txt-black");
						$('.txt-p1').val('0');
						$('#maxPageCount').text('0');
						popupNoRecordEvent(attrIdVal);
					}else{
						$("#open-pop-up-box").show();
						var scrollTop = $('#parentDivForPopTable').scrollTop();
					    if(scrollTop > 0) {
					    	pageFirstLoad = 1;
					    }    
						//Setting Data related to search related functionality.
						$('.txt-p1').val(pageNumber);
						pagination_scroll_change_pageNo = pageNumber;
						if(pageNumber > 1){
							$('.prev-btn-p1,.prev-first-p1').removeAttr('disabled');
							$('.prev-btn-p1,.prev-first-p1').removeClass('disabled');
							$('.first-btn-p1').removeAttr('disabled');
							$('.first-btn-p1').removeClass('disabled');
							
						}else{
							$('.prev-btn-p1,.prev-first-p1').attr('disabled', 'disabled');
							$('.prev-btn-p1,.prev-first-p1').addClass('disabled');
							$('.first-btn-p1').attr('disabled', 'disabled');
							$('.first-btn-p1').addClass('disabled');
						}
						if(maxRowCount <= parseInt(pageNumber) ){
							$('.next-btn-p1,.next-last-p1').attr('disabled', 'disabled');
							$('.next-btn-p1,.next-last-p1').addClass('disabled');
							$('.last-btn-p1').attr('disabled', 'disabled');
							$('.last-btn-p1').addClass('disabled');
						}else if(maxRowCount > parseInt(pageNumber) ){
							$('.next-btn-p1,.next-last-p1').removeAttr('disabled');
							$('.next-btn-p1,.next-last-p1').removeClass('disabled');
							$('.last-btn-p1').removeAttr('disabled');
							$('.last-btn-p1').removeClass('disabled');
						}
						$('#maxPageCount').text(maxRowCount);
						$('#pop-up-table').closest('.tableArrow').animate({ scrollTop: 0 }, "fast");
						$('#pop-up-table').closest('.floatThead-wrapper').find('.floatThead-table').find('thead').html($('#pop-up-table').find('thead').html());
						$('#pop-up-table').floatThead('destroy');
						setTimeout(function() {
							$('#pop-up-table').floatThead({position: 'absolute', scrollContainer: true, autoReflow: true, copyTableClass: true, enableAria: true });
						}, 0);
					}
				}else{//Scroll Down Value Appending
					populateScrollDownTableData(dataListArray);
					pagination_scroll_change_flag = true;
					ajaxConfirm = '1';
					if(onLoad){
						if(dataListArray[1][0] > 1000){ // Configurable page wise........
							textLengthToSearch = 2;
						}else{
							textLengthToSearch = 0;
						}
					}
					$('.txt-p1').val(pageNumber);
					if(pageNumber > 1){
						$('.prev-btn-p1,.prev-first-p1').removeAttr('disabled');
						$('.prev-btn-p1,.prev-first-p1').removeClass('disabled');
						$('.first-btn-p1').removeAttr('disabled');
						$('.first-btn-p1').removeClass('disabled');
					}else{
						$('.prev-btn-p1,.prev-first-p1').attr('disabled', 'disabled');
						$('.prev-btn-p1,.prev-first-p1').addClass('disabled');
						$('.first-btn-p1').attr('disabled', 'disabled');
						$('.first-btn-p1').addClass('disabled');
					}
					if(maxRowCount <= parseInt(pageNumber) ){
						$('.next-btn-p1,.next-last-p1').attr('disabled', 'disabled');
						$('.next-btn-p1,.next-last-p1').addClass('disabled');
						$('.last-btn-p1').attr('disabled', 'disabled');
						$('.last-btn-p1').addClass('disabled');
					}else if(maxRowCount > parseInt(pageNumber) ){
						$('.next-btn-p1,.next-last-p1').removeAttr('disabled');
						$('.next-btn-p1,.next-last-p1').removeClass('disabled');
						$('.last-btn-p1').removeAttr('disabled');
						$('.last-btn-p1').removeClass('disabled');
					}
					$('#maxPageCount').text(maxRowCount);
				}
				keyNavigationFunc();
				scrlDown = false;
				$.trim(searchFocus).length != 0 ? $('#'+searchFocus).addClass("getInFocus").focus() : $("#inputSrId").addClass("getInFocus").focus();
				if(!displayPaginationHeader){
					hideDivBasedOnClass('pagination-master');
				}
				if(!displaySearchFooter){
					hideDivBasedOnClass('search-show-hide');
				}
			}else{
				$('#pop-up-table tbody tr').html("");
				$('#display-message').text("No Record Found");
			    $('#display-message').removeClass("txt-black");
				//$.messager.alert('Information ','No Record Found','info');
				$('.txt-p1').val('0');
				$('#maxPageCount').text('0');
				popupNoRecordEvent(attrIdVal);
			}
		},
		error: function (error) {
		}
	});
}
var blockKeyUp = false;
function keyNavigationFunc(){
	$('div.rsPopup_div, td.rsPopup_cell').off('keyup').on('keyup', function(e){console.log(blockKeyUp);
		if(!blockKeyUp && !( e.ctrlKey &&  e.keyCode == 66 ) ){
			var keyCode = (e.keyCode ? e.keyCode : e.which); 
			if( pagination_for_multi_selection_flag && keyCode == 32 ){
				return;
			}
			if(keyCode === 8){
				if(($("#inputSrId").hasClass("getInFocus") || $("#add-input-sr-id").hasClass("getInFocus")) && displaySearchFooter){
					callControllerOnSearchText();
				}
				e.stopPropagation();
			}else if(keyCode !== 27 && keyCode !== 9 && keyCode !== 13 && keyCode !== 38 && keyCode !== 40 && keyCode !== 37 && keyCode !== 39 && keyCode !== 8 && keyCode !== 33 && keyCode !== 34){
				if(($("#inputSrId").hasClass("getInFocus") || $("#add-input-sr-id").hasClass("getInFocus")) && e.which != 2 && e.which != 13 && e.which != 16 && e.which != 17 && e.which != 18 && displaySearchFooter){
					callControllerOnSearchText();
				}
				e.stopPropagation();
			}
		}
		blockKeyUp = false;
		
	});
	// Code Added for page number Edit
	$('#page-no-id').off('keydown').on('keydown',function(e){
		var page_Val=$(this).val();get_val=$(this).val().length;
		if(e.keyCode==8){
			var Slice_val=get_val-1;sendvalget=parseInt(Slice_val)
			if(get_val>0){
				var valtstr=page_Val.toString();falval=valtstr.slice(0,sendvalget)
				$(this).val(falval);
				}
			return false;
		}
		else if(e.keyCode<58 && e.keyCode>46){
			  var value =String.fromCharCode(e.keyCode);mxlength=maxRowCount[0];getlenmax=mxlength.toString();
			  get_val=$(this).val().length;appendValue=page_Val+value;
			  if(parseInt(mxlength)>=parseInt(appendValue) || page_Val==""){
				  $(this).val(appendValue);
			  }
			 else{
				  return false;
			  } 
			  return false;
			
		}
	});
	
	$(".page_multi_select").on("change",function(e){
		var checked = $(this).is(":checked");
		var value  = $(this).attr("data-value");
		if( checked ){
			//add if not exist
			if( pagination_for_multi_select_checked_list.indexOf(value)  == -1 ){
				pagination_for_multi_select_checked_list.push(value);
			}
		}else{
			//remove if exist
			var index = pagination_for_multi_select_checked_list.indexOf(value);
			if( index >= 0 ){
				pagination_for_multi_select_checked_list.splice(index,1);
			}
		}
		
	});
	
	$("#pagination-multi_select_checkbox-all").on("change",function(e){
		var checked = $(this).is(":checked");
		if( checked ){
		    	displayLoadingImage();
		    	$(".page_multi_select").prop("checked",true);
			for(var i=1;i<pagination_for_multi_select_all_records.length;i++){
			    var value = pagination_for_multi_select_all_records[i][pagination_for_multi_select_compare_col_index];
			    if(pagination_for_multi_select_checked_list.indexOf(value) == -1){
				pagination_for_multi_select_checked_list.push(value);
			    }
			}
			pagination_for_multi_select_array_all_data = pagination_for_multi_select_all_records;
			hideLoadingImage();
		}else{
		    //remove if exist
		    pagination_for_multi_select_checked_list = [];
		    $(".page_multi_select").prop("checked",false);
		}
		
	});
	
	$('.populateDataOnOk').on('keydown',function(e){if(e.keyCode==9){$('.close-pop-up').focus();return false;}});
	$('.close-pop-up').on('keydown',function(e){if(e.keyCode==9){$('#pop-up-table tbody tr td.active').focus().trigger('click');return false;}});
	
	$('div.rsPopup_div, td.rsPopup_cell').off('keydown').on('keydown', function(e){
		//keydown for page no. and search input
		var keyCode = (e.keyCode ? e.keyCode : e.which); 
		if(keyCode==9){$('.populateDataOnOk ').focus();return false;}
		if(keyCode !== 27 && keyCode !== 9 && keyCode !== 13 && keyCode !== 38 && keyCode !== 40 && keyCode !== 37 && keyCode !== 39 && keyCode !== 8){
			if($("#page-no-id").hasClass("getInFocus") && displayPaginationHeader){
				-1!==$.inArray(e.keyCode,[46,8,9,27,13,110])||/65|67|86|88/.test(e.keyCode)&&(!0===e.ctrlKey||!0===e.metaKey)||35<=e.keyCode&&40>=e.keyCode||(e.shiftKey||48>e.keyCode||57<e.keyCode)&&(96>e.keyCode||105<e.keyCode)&&e.preventDefault()
			}
			e.stopPropagation();
		}
		pageCount = 200;
		if(editAllowed == true){
			//var keyCode = (e.keyCode ? e.keyCode : e.which); 
			var evtobj = window.event? event : e;
			var type = $(this).is('td') ? 'td' : 'div';
			var currentFocus = $(':focus');
			var activeTd = '';
			var table = '';
			var tdIndex = '';
			var parentTr = '';
			var divWrapper = '';
			if(type == 'td') {
				activeTd = $(this);
				tdIndex = activeTd.index();
				parentTr = activeTd.parent('tr');
				table = parentTr.parent('tbody').parent('table');
				divWrapper = table.parent('div').parent('div.pnl-content').parent('div.pnl-wrapper');
			}
			else {
				divWrapper = $(this).children('div.pnl-wrapper');
				table = divWrapper.children('div.pnl-content').find('table');
				activeTd = table.find('tr').find('td.active');
				if(activeTd.length > 0) {
					tdIndex = activeTd.index();
					parentTr = activeTd.parent('tr');
				}
			}
			// ctrl + b search toggle
			if (keyCode == 66 && evtobj.ctrlKey && displaySearchFooter) {
				/*if(open_popup_key.defaultColumnSearch != null && open_popup_key.defaultColumnSearch.length > 0) {
					open_popup_key.defaultColumnSearch = '';
				} else {
					nextSelectOption++;
				}
				nextSelectOption = nextSelectOption < $("#selectOnId option").length ? nextSelectOption : 0;
				removeSelection = nextSelectOption != 0 ? (nextSelectOption - 1) : ($("#selectOnId option").length - 1);
				$('#selectOnId option:eq('+removeSelection+')').prop('selected', false);
				$('#selectOnId option:eq('+nextSelectOption+')').prop('selected', true);
				callControllerOnDropDownChange();
				reloadAdditionSearchOption();
				*/
				e.preventDefault();
				e.stopPropagation();
				var change_field = $( "#selectOnId" ),
					curr = change_field.find( "option[value='"+$( "#selectOnId" ).val()+"']" ),
					next = curr.next(),currop=change_field.find('option').length,newopt='',
					change_field_2 = $( "#add-select-on-id" );

				curr.removeAttr( "selected" );
				
				if( next.length != 0 ){
					change_field.val( next.attr( "value" ) );
				} else {
					change_field.val( next.attr( "value" ) );
					change_field.val( change_field.find( "option:first-child" ).attr( "value" ) );
				}
				
				if( change_field.val() == change_field_2.val() ){
					if( change_field_2.find( "option[val='"+change_field_2.val()+"']" ).next().length != 0 ){
						change_field_2.val( change_field_2.find( "option[val='"+change_field_2.val()+"']" ).next().attr( "val" ) );
					} else {
						change_field_2.val( change_field_2.find( ":first-child" ).next().attr( "val" ) );
					}
				}
				return false;
			}
			
			if((keyCode == 39 ) && evtobj.ctrlKey){
				if(!$('.next-btn-p1').hasClass('disabled'))
					$('.next-btn-p1').focus().trigger('click');
				$('#inputSrId').focus();
				return false;
			}if((keyCode == 37) && evtobj.ctrlKey){
				if(!$('.prev-btn-p1').hasClass('disabled'))
					previousButtonClick();
				$('#inputSrId').focus();
				return false;
			}if((keyCode == 35) && evtobj.ctrlKey){
				if(!$('.next-last-p1').hasClass('disabled')){
					blockKeyUp = true;
					callControllerOnPageUpDown(parseInt(maxRowCount));
					$('#parentDivForPopTable').animate({scrollTop: 892});
					setTimeout(function(){
						$('#parentDivForPopTable table tbody tr:last td:eq(1)').trigger('click');	
					},1000)
					return false;
				}else{
					$('#parentDivForPopTable').animate({scrollTop: 892});
					setTimeout(function(){
						$('#parentDivForPopTable table tbody tr:last td:eq(1)').trigger('click');	
					},1000)
					return false;
				}
					
			}
			
			
			switch(keyCode) {
			// esc 
			case 27:
				table.parents('#open-pop-up-box div').find('div.pnl-header-btns-hldr a.close-pop-up').trigger('click');
				e.preventDefault();
				e.stopPropagation();
				break;
				// tab 
			case 32:
				if(pagination_for_multi_selection_flag){
					blockKeyUp = true;
					var chkd = $(this).parent().find("td:eq(0)").find("input.page_multi_select").is(":checked");
					$(this).parent().find("td:eq(0)").find("input.page_multi_select").attr("checked",!chkd);
					$(this).parent().find("td:eq(0)").find("input.page_multi_select").trigger("change");
					e.preventDefault();
					e.stopPropagation();
					
				}else{
					if($('#add-input-sr-id').is(':visible')) {
						if(!$('#add-input-sr-id').is(":focus")) {
							$('#inputSrId').focus();
						}
					} else {
						$("#inputSrId").focus();
					}
				}
				
				break;
				// tab 
			case 9:
				if(currentFocus.hasClass('rsPopup_beforeTable')) {
					var nextElement = currentFocus.parent('label').next('label').find('.rsPopup_beforeTable');
					if(nextElement.length > 0) {
						nextElement.focus();
					}
					else {
						if(activeTd.length > 0 ) {
							activeTd.focus();
						}
						else {
							table.find('tbody tr:visible td:eq(1)').addClass('active').focus();
						}
					}
				}
				else if(currentFocus.hasClass('rsPopup_searchInput')) {
					var nextElement = currentFocus.parent('label').next('label').find('.rsPopup_searchInput');
					if(nextElement.length > 0) {
						nextElement.focus();
					}
					else {
						var button = divWrapper.children('div.pnl-footer').find('input.rsPopup_button:first');
						if(button.length > 0) {
							button.focus();
						}
					}
				} else if(currentFocus.hasClass('rsPopup_button')) {
					nextElement = currentFocus.next('input.rsPopup_button');
					if(nextElement.length > 0) {
						nextElement.focus();
					}else {
						var beforeTableElement = divWrapper.children('div.pnl-content').find('.rsPopup_beforeTable:first');
						if(beforeTableElement.length > 0) {
							beforeTableElement.focus();
						}
						else {
							if(activeTd.length > 0 ) {
								activeTd.focus();
							}else {	
								var firstCell = table.find('tbody tr:visible td:eq(1)');
								if(firstCell.length > 0) {
									firstCell.addClass('active').focus();
								}
								else {
									var searchInput = divWrapper.children('div.pnl-footer').find('.rsPopup_searchInput:first');
									if(searchInput.length > 0 ) {
										searchInput.focus();
									}
									else {
										var button = divWrapper.children('div.pnl-footer').find('input.rsPopup_button:first');
										if(button.length > 0) {
											button.focus();
										}
										else {
											activeTd.focus();
										}
									}
								}
							}
						}
					}
				}else if(currentFocus.is('div.rsPopup_div') || currentFocus.is('td.rsPopup_cell')) {
					if(activeTd.length == 0 ) {
						table.find('tbody tr:visible td:eq(1)').addClass('active').focus();
					}
					else {
						var searchInput = divWrapper.children('div.pnl-footer').find('.rsPopup_searchInput:first');
						if(searchInput.length > 0 ) {
							searchInput.focus();
						}
						else {
							var button = divWrapper.children('div.pnl-footer').find('.rsPopup_button:first');
							if(button.length > 0) {
								button.focus();
							}
							else {
								activeTd.focus();
							}
						}
					}
				}
				else {
					table.find('tbody tr:visible td:eq(1)').addClass('active').focus();
				}
				e.preventDefault();
				e.stopPropagation();
				break;
				//enter 
			case 13:
				if($("#page-no-id").hasClass("getInFocus") && displayPaginationHeader){
					//do server side pagination call here..
					callControllerOnPageEnter();
					$("#page-no-id").removeClass("getInFocus");
				} else if(currentFocus.hasClass('rsPopup_button')) {
					currentFocus.trigger('click');
				} else if(activeTd.length > 0 ) {
					activeTd.trigger('dblclick');
				}
				e.preventDefault();
				e.stopPropagation();
				break;
				// up
			case 38:
				var currentFocus = $(':focus');
				if(currentFocus.is('select')) {   		
					return false;
				}
				if(activeTd.length > 0 ) {
					var tdIndex = activeTd.index();
					var parentTr = activeTd.parent('tr');
					var preTr = parentTr.prev(':visible');
					if (preTr.length == 0) {
						preTr = parentTr.prevUntil(':visible').last().prev();
					}
					if(preTr.length > 0) {
			    		if(parentTr.prev(':visible').prev(':visible').length == 0){
			    			table.closest(".tableArrow").animate({ scrollTop: 0 }, "slow");
			    		}
						activeTd.removeClass('active');
						parentTr.find('td:eq(0) > img').hide();
						preTr.find('td:eq('+tdIndex+')').addClass('active').focus();
						preTr.find('td:eq(0) > img').show();
					}
				}
				else {
					table.find('tbody tr:visible td:eq(1)').addClass('active').focus();
					table.find('tbody tr:visible td:eq(0)').find('img').show();
				}
				e.preventDefault();
				e.stopPropagation();
				break;
				// down 
			case 40:
				var currentFocus = $(':focus');
				if(currentFocus.is('select')) {   		
					return false;
				}
				if(activeTd.length > 0 ) {
					var tdIndex = activeTd.index();
					var parentTr = activeTd.parent('tr');
					var nextTr = parentTr.next(':visible');
					if (nextTr.length == 0) {
						nextTr = parentTr.nextUntil(':visible').last().next();
					}
					if(nextTr.length > 0) {
						activeTd.removeClass('active');
						parentTr.find('td:eq(0) > img').hide();
						nextTr.find('td:eq('+tdIndex+')').addClass('active').focus();
						nextTr.find('td:eq(0) > img').show();
					}
				}
				else {
					table.find('tbody tr:visible td:eq(1)').addClass('active').focus();
					table.find('tbody tr:visible td:eq(0)').find('img').show();
				}
				e.preventDefault();
				e.stopPropagation();
				break;
				// left
			case 37:
				if(activeTd.length > 0 ) {
					var parentTr = activeTd.parent('tr');
					var tdIndex = activeTd.index();
					if(tdIndex > 1) {
						var leftTd = parentTr.find('td:eq('+(tdIndex-1)+')');
						if(leftTd.length > 0) { 
							activeTd.removeClass('active');
							leftTd.addClass('active').focus();
						}
					}else{
						parentTr.find('td:eq('+(tdIndex-1)+')').focus();
						var leftTd = parentTr.find('td:eq('+(tdIndex)+')');
						if(leftTd.length > 0) { 
							activeTd.removeClass('active');
							leftTd.addClass('active').focus();
						}
			    	}
				}
				else {
					table.find('tbody tr:visible td:eq(1)').addClass('active').focus();
					table.find('tbody tr:visible td:eq(0)').find('img').show();
				}
				e.preventDefault();
				e.stopPropagation();
				break;
				// right 
			case 39:
				if(activeTd.length > 0 ) {
					var parentTr = activeTd.parent('tr');
					var tdIndex = activeTd.index();
					var rigthTd = parentTr.find('td:eq('+(tdIndex+1)+')');
					if(rigthTd.length > 0) { 
						activeTd.removeClass('active');
						rigthTd.addClass('active').focus();
					}
				}
				else {
					table.find('tbody tr:visible td:eq(1)').addClass('active').focus();
					table.find('tbody tr:visible td:eq(0)').find('img').show();
				}
				e.preventDefault();
				e.stopPropagation();
				break;
			case 33:
				// Write logic for Page UP
				//callControllerOnPageUpDown(1);
				callScrolldownForPageUpDown(e, 1, table);
				break;
			case 34:
				// Write logic for Page UP
				//callControllerOnPageUpDown(maxRowCount);
				callScrolldownForPageUpDown(e, 2, table);
				blockKeyUp = true;
				e.preventDefault();
				e.stopPropagation();
				break;
			default:
				if($('#add-input-sr-id').is(':visible')) {
					if(!$('#add-input-sr-id').is(":focus")) {
						$('#inputSrId').focus();
					}
				} else {
					$("#inputSrId").focus();
				}
			}
		}
	}).off('click').on('click','td.rsPopup_cell', function(e){
		if(editAllowed == true){
			var tbody = $(this).parent('tr').parent('tbody');
			tbody.find('td').removeClass('active');
			tbody.find('tr :nth-child(1)').find('img').hide();
			$(this).addClass('active').parent('tr').find('td:eq(0) > img').show();
			$(this).focus();
		}
	});
}

$("#page-no-id").on("click",function(){
	$("#inputSrId").removeClass("getInFocus");
	$("#add-input-sr-id").removeClass("getInFocus");
	$("#page-no-id").addClass("getInFocus");
});
$("#inputSrId").on("click",function(){
	$("#page-no-id").removeClass("getInFocus");
	$("#add-input-sr-id").removeClass("getInFocus");
	$("#inputSrId").addClass("getInFocus");
});
$("#add-input-sr-id").on("click",function(){
	$("#page-no-id").removeClass("getInFocus");
	$("#inputSrId").removeClass("getInFocus");
	$("#add-input-sr-id").addClass("getInFocus");
});

function callControllerOnSearchText(){
	var searchText = $(".inputSr").val();
	var addSearchText = $('#add-input-sr-id').val();
	var searchOn = $( "select#selectOnId option:selected").val();
	var pageNumber = 1;
	freezeMaxCount = false;
	scrlDown = false;
	pageload='0';
	onLoad = false;
	searchFocus = $(':focus').attr('id');
	if(searchFocus === 'add-input-sr-id'){
		if(addSearchText.length >= textLengthToSearch || addSearchText.length == 0){
			var targetJSON = getPaginationParams(getPaginationJasonParam(attrIdVal, "", pageNumber, searchOn, viewName));
			loadTableTdBody(pageNumber, targetJSON);
		}
	}else {
		if(searchText.length >= textLengthToSearch || searchText.length == 0){
			var targetJSON = getPaginationParams(getPaginationJasonParam(attrIdVal, "", pageNumber, searchOn, viewName));
			loadTableTdBody(pageNumber, targetJSON);
		}
	}
}

function callControllerOnDropDownChange(){
	var searchText = '';
	freezeMaxCount = false;
	scrlDown = false;
	pageload='0';
	onLoad = false;
	var searchOn = $( "select#selectOnId option:selected").val();
	var pageNumber = 1;
	var targetJSON = getPaginationParams(getPaginationJasonParam(attrIdVal, "", pageNumber, searchOn, viewName));
	loadTableTdBody(pageNumber, targetJSON);
	$(".inputSr").val(searchText);
}

function callControllerOnNextPrevClick(pageNumber){
	onLoad = false;
	scrlDown = false;
	pageload='0';
	var searchText = $(".inputSr").val();
	var searchOn = $( "select#selectOnId option:selected").val();
	var pageNumber = parseInt(pageNumber);
	var targetJSON = getPaginationParams(getPaginationJasonParam(attrIdVal, "", pageNumber, searchOn, viewName));
	loadTableTdBody(pageNumber, targetJSON);
}

function callControllerOnPageEnter(){
	onLoad = false;
	scrlDown = false;
	pageload='0';
	var pageNumber = 0;
	var searchText = $(".inputSr").val();
	var searchOn = $( "select#selectOnId option:selected").val();
	if(parseInt($.trim($('.txt-p1').val())) == 0 || $.trim($('.txt-p1').val()).length == 0){
		pageNumber = 1;
	}else{
		pageNumber = parseInt($.trim($('.txt-p1').val()));
	}
	if(pageNumber > maxRowCount){
		pageNumber = maxRowCount;
	}
	freezeMaxCount = true;
	var targetJSON = getPaginationParams(getPaginationJasonParam(attrIdVal, "", pageNumber, searchOn, viewName));
	loadTableTdBody(pageNumber, targetJSON);
}

$('.next-btn-p1, .last-btn-p1').click(function(){
	freezeMaxCount = true;
	scrlDown = false;
	pageload='0';
	var pageNumber = 0;
	if($(this).hasClass("last-btn-p1") !== true){
		if(parseInt($.trim($('.txt-p1').val())) == 0 || $.trim($('.txt-p1').val()).length == 0){
			pageNumber = 1;
		}else{
			pageNumber = parseInt($.trim($('.txt-p1').val()))+1;
		}
		if(parseInt($.trim($('.txt-p1').val())) > parseInt($.trim($('#maxPageCount').text()))){
			pageNumber = parseInt($.trim($('#maxPageCount').text()));
		}
	}else{
		pageNumber = parseInt($.trim($('#maxPageCount').text()));
	}
	callControllerOnNextPrevClick(pageNumber);
	$('.txt-p1').val(pageNumber);
	pagination_scroll_change_pageNo = pageNumber;
	$('.prev-btn-p1,.prev-first-p1').removeAttr('disabled');
	$('.prev-btn-p1,.prev-first-p1').removeClass('disabled');
	$('.first-btn-p1').removeAttr('disabled');
	$('.first-btn-p1').removeClass('disabled');
	if(maxRowCount > parseInt(pageNumber)){
		$('.next-btn-p1,.next-last-p1').removeAttr('disabled');
		$('.next-btn-p1,.next-last-p1').removeClass('disabled');
		$('.last-btn-p1').removeAttr('disabled');
		$('.last-btn-p1').removeClass('disabled');
	}else{
		$('.next-btn-p1,.next-last-p1').attr('disabled', 'disabled');
		$('.next-btn-p1,.next-last-p1').addClass('disabled');
		$('.last-btn-p1').attr('disabled', 'disabled');
		$('.last-btn-p1').addClass('disabled');
	}		
});

$('.next-last-p1').on('click',function(){
	callControllerOnPageUpDown(parseInt(maxRowCount));
});
$('.prev-first-p1').on('click',function(){
	callControllerOnPageUpDown(1);
});

function previousButtonClick(){
	freezeMaxCount = true;
	scrlDown = false;
	pageload='0';
	var pageNumber = 0;
	
	if(arguments[0] !== "first"){
		if(parseInt($.trim($('.txt-p1').val())) == 0 || $.trim($('.txt-p1').val()).length == 0){
			pageNumber = 1;
		}else{
			pageNumber = parseInt($.trim($('.txt-p1').val()))-1;
		}
		if(parseInt($.trim($('.txt-p1').val())) > parseInt($.trim($('#maxPageCount').text()))){
			pageNumber = parseInt($.trim($('#maxPageCount').text()));
		}
	}else{
		pageNumber = 1;
	}
	callControllerOnNextPrevClick(pageNumber);	
	$('.txt-p1').val(pageNumber);
	$('#maxPageCount').text(maxRowCount);
	if(parseInt(pageNumber) == 1 ){
		$('.prev-btn-p1,.prev-first-p1').attr('disabled', 'disabled');
		$('.prev-btn-p1,.prev-first-p1').addClass('disabled');
		$('.first-btn-p1').attr('disabled', 'disabled');
		$('.first-btn-p1').addClass('disabled');
	}else if(parseInt(pageNumber) > 1){
		$('.prev-btn-p1,.prev-first-p1').removeAttr('disabled');
		$('.prev-btn-p1,.prev-first-p1').removeClass('disabled');
		$('.first-btn-p1').removeAttr('disabled');
		$('.first-btn-p1').removeClass('disabled');
	}
	if(pageNumber < maxRowCount){
		$('.next-btn-p1,.next-last-p1').removeAttr('disabled');
		$('.next-btn-p1,.next-last-p1').removeClass('disabled');
		$('.last-btn-p1').removeAttr('disabled');
		$('.last-btn-p1').removeClass('disabled');
	}else{
		$('.next-btn-p1,.next-last-p1').attr('disabled', 'disabled');
		$('.next-btn-p1,.next-last-p1').addClass('disabled');
		$('.last-btn-p1').attr('disabled', 'disabled');
		$('.last-btn-p1').addClass('disabled');
	}
}

$('.prev-btn-p1').click(function(){
	previousButtonClick();
});
$('.first-btn-p1').click(function(){
	previousButtonClick("first");
});
//POP screen close/minimise functionality.
$(".close-pop-up, .min-pop-up").on("click", function() {
	$('#pop-up-table tbody').empty();
	scrlDown = false;
	pageload='0';
	$('#display-message').text("");
	$('#selectOnId option:selected').removeAttr('selected');
	$('#open-pop-up-box #add-search-fields-div').hide();
	$('#add-img-id').find('img').show();
	$('#minus-img-id').find('img').hide();
	$('#open-pop-up-box').hide();
	
	pagination_for_multi_selection_flag = false;
	pagination_for_multi_select_compare_col_index = 0;
	pagination_for_multi_select_checked_list = [];
	pagination_for_multi_select_array_all_data = [];
	pagination_for_multi_select_result_data = [];
	popupCloseEvent(attrIdVal);
});

//On OK button Populate data.........
$('.populateDataOnOk').off("click").on("click",function(){
	scrlDown = false;
	pageload='0';
	var highlightedRow = $('#pop-up-table tbody tr:has(td.active)').index();
	if(pagination_for_multi_selection_flag){
	   
		displayLoadingImage();
		setTimeout(function(){
		    	prepareMultiSelectResultData();
			populateDataIntoParentTable_internal($('#pop-up-table tbody tr:eq('+highlightedRow+') td:eq(0)'));
		    	hideLoadingImage();
		},100);
	}else{
	    populateDataIntoParentTable_internal($('#pop-up-table tbody tr:eq('+highlightedRow+') td:eq(0)'));
	}
		
});

/*
 * var pagination_for_multi_selection_flag = false;
var pagination_for_multi_select_compare_col_index = 0;
var pagination_for_multi_select_checked_list = [];
var pagination_for_multi_select_array_all_data = [];
var pagination_for_multi_select_result_data = [];
 * */
function prepareMultiSelectResultData(){
	pagination_for_multi_select_result_data = [];
	for(var i=0;i<pagination_for_multi_select_checked_list.length;i++){
		for( var j=0;j<pagination_for_multi_select_array_all_data.length;j++ ){
			if( pagination_for_multi_select_checked_list[i] == pagination_for_multi_select_array_all_data[j][pagination_for_multi_select_compare_col_index] ){
				pagination_for_multi_select_result_data.push(pagination_for_multi_select_array_all_data[j]);
			}
		}
	}
}

function loadingBlock(block) {
	// add the overlay with loading image to the page
	if($('.overLayImage')){
		$('.overLayImage').remove();
	}
	var over = '<div id="overlay" class="overLayImage">' +
	'<img id="loading" src="/rsunify/resources/imgs/loading.gif">' +
	'</div>';
	$(over).appendTo('body');
	if(block === true){
		$('body').addClass('blockedBody');  
	}        
};

function removeLoading() {
	$('.overLayImage').remove();
	if($('body').hasClass('blockedBody')){
		$('body').removeClass('blockedBody')
	}
}

//Open pop-up screen on mouse double click and generate Table HTML dynamically.
$("#load-all-button").on("click", function() {
	$('#excludeSearchCriteriaId').focus().trigger('click');
	$('.inputSr').focus();
	var pageNumber = 1;
	 pageCount = 1000;
	if(checkPopScreenAccess()){
		popTableJsonObject = provideFieldAndTableInformation();
		$('#pop-up-table').attr('class',"tbl-fixed-headers-pagination "+attrIdVal+"");
		$('#pop-up-box-title').text(popTableJsonObject[attrIdVal][0].title);
		viewName = popTableJsonObject[attrIdVal][0].viewName;
		$('#pop-up-table thead').html('');
		$('#pop-up-table tbody').html('');
		/*if($('.floatThead-container')){$('.floatThead-container').remove();}*/
		$(".inputSr").val('');
		var searchText = $(".inputSr").val();
		var searchOn = '';
		$("#selectOnId").focus();
		var targetJSON = getPaginationParams(getPaginationJasonParam(attrIdVal, "", pageNumber, searchOn, viewName));
		freezeMaxCount = false;
		onLoad = true;
		loadTableTdBody(pageNumber, targetJSON);
		$(this).addClass('countThousand');
		//table fixed header 
	}
});

$('#selectTypeId').on('change', function(){
	freezeMaxCount = false;
	onLoad = false;
	var searchOn = $( "select#selectOnId option:selected").val();
	var pageNumber = 1;
	var targetJSON = getPaginationParams(getPaginationJasonParam(attrIdVal, "", pageNumber, searchOn, viewName));
	loadTableTdBody(pageNumber, targetJSON);
});

// added jegadish.manoharan for additional criteria search type 
$('#add-select-type-id').on('change', function(){
	callControllerOnSearchText();
});

//added jegadish.manoharan for additional criteria search column
$('#add-select-on-id').on('change', function() {
	var addSearchText = $('#add-input-sr-id').val(),addSel=$('#selectOnId').val(),
	change_field = $( "#selectOnId" ),
	curr = change_field.find( "option[value='"+$( "#selectOnId" ).val()+"']" ),
	next = curr.next();
	$('#add-select-type-id').val("1");
	if($(this).val()==addSel){
		if( next.length != 0 ){
			change_field.val( next.attr( "value" ) );
		} else {
			change_field.val( next.attr( "value" ) );
			change_field.val( change_field.find( "option:first-child" ).attr( "value" ) );
		}
	}
	if(addSearchText.length > 0) {
		$('#add-input-sr-id').val('');
		callControllerOnSearchText();
	}
});


//Scroll Down Added By Sathishkumar Veeramani
function tableScrollDown(scrollId){ //Scroll Down
	if(pageFirstLoad == 0){
		if ($(scrollId).scrollTop() >= ($("#pop-up-table").height() - $('.tableArrow').height())*0.60){
			if(!$('.next-btn-p1').hasClass('disabled') && ajaxConfirm == 1){
				if(parseInt($('.txt-p1').val()) > 0){
					ajaxConfirm = '0';
					scrlDown = true;
					popTableJsonObject = provideFieldAndTableInformation();
					$('#pop-up-table').attr('class',"tbl-fixed-headers-pagination "+attrIdVal+"");
					viewName = popTableJsonObject[attrIdVal][0].viewName;
					var pageNumber = parseInt($('.txt-p1').val())+1;				
					var searchText = $(".inputSr").val();
					var searchOn = $('#selectOnId').val();
					//$("#selectOnId").focus();
					var targetJSON = getPaginationParams(getPaginationJasonParam(attrIdVal, "", pageNumber, searchOn, viewName));
					//alert(targetJSON);
					freezeMaxCount = false;
					if(castScrollUpDown == false){
						if(parseInt($('.txt-p1').val()) > 3){
							pageload = '1';
						}
					}
					loadTableTdBody(pageNumber, targetJSON);
					$("#selectOnId").focus();
				}
			}
		}	
	}else{
		var scrollTop = $('#parentDivForPopTable').scrollTop();
	    if(scrollTop == 0) {
	    	pageFirstLoad = 0;
	    }
	}
	
	if( pagination_scroll_change_flag){
		var val = parseInt( $('.tableArrow').scrollTop() / ($("#pop-up-table tbody tr:eq(0)").outerHeight() * 200 ));
		$("#page-no-id").val(Math.min(pagination_scroll_change_pageNo + val,parseInt($("#maxPageCount").text())));
	}
	
}



$('.tableArrow').off('scroll').on('scroll', function(e){
	if($.trim(e.target.id) == "parentDivForPopTable"){
		tableScrollDown("#"+e.target.id);
	}
});
//Till Here

//Pagination Header Click to Change Search on Value
$('#pop-up-table thead').on('click',function(event){
	event.preventDefault();
	event.stopPropagation();
	var change_field = $( "#selectOnId" ),
		curr = change_field.find( "option[value='"+$( event.target ).text()+"']" );
		if( curr.length != 0 ){
			change_field.val( curr.attr( "value" ) );
		}
	return false;
});
//Till Here

//Hide div section based on class
function hideDivBasedOnClass(elementClass){
	$("."+elementClass).hide();
}

//Generic implementation to populate data from into POP screen
function populateDataIntoTableBody(dataListArray){/*Get no of hidden columns from left side*/
	var popUpHeaderHtml = "<tr><th>";
	var popUpDataHtml = "";
	var selectOptionHtml = "";
	if(!freezeMaxCount){
		maxRowCount = dataListArray[1][0];
	}
	var listOfRows = dataListArray[0];
	var header = listOfRows[0];
		
		// first table header column set hidden column values
		for(var i=0; i < noOfHiddenColumnsFromFirst; i++) {
				popUpHeaderHtml += "<input type='hidden' value='"+header[i]+"'/>";
		}
		
		popUpHeaderHtml += "</th>";
		
		var optionIdx = 1;
		// search passed column name index
		if(open_popup_key.isFirstColumnEnable && !open_popup_key.firstColumnIdx) {
			for (var i = noOfHiddenColumnsFromFirst; i < header.length; i++) {
				var selectedColumnSearch = open_popup_key.defaultColumnSearch;
				if(selectedColumnSearch && selectedColumnSearch.length > 0 && selectedColumnSearch.toLowerCase() === header[i].toLowerCase()) {
					open_popup_key.firstColumnIdx = i;
					break;
				}
			}
		}
		
		//table header first column logic
		if(open_popup_key.isFirstColumnEnable && !isNaN(open_popup_key.firstColumnIdx)) {
			popUpHeaderHtml += "<th>"+header[open_popup_key.firstColumnIdx]+"</th>";
			var firstColumnSearch = $("select#selectOnId option:selected").val();
			if( firstColumnSearch != null && firstColumnSearch.length > 0  ){
				firstColumnSearch = firstColumnSearch.toLowerCase();
			}
			if( firstColumnSearch == header[open_popup_key.firstColumnIdx].toLowerCase() ){
				selectOptionHtml += "<option idx="+optionIdx+" value='"+header[open_popup_key.firstColumnIdx]+"' selected='selected'>"+header[open_popup_key.firstColumnIdx]+"</option>";
			}else{
				selectOptionHtml += "<option idx="+optionIdx+" value='"+header[open_popup_key.firstColumnIdx]+"'>"+header[open_popup_key.firstColumnIdx]+"</option>";
			}
			
			optionIdx++;
			header.splice(open_popup_key.firstColumnIdx,1);
		}
		
				
		// search on column population + table header 
		for (var i = noOfHiddenColumnsFromFirst; i < header.length; i++) {
			popUpHeaderHtml += "<th>"+header[i]+"</th>";
			var selectedColumnSearch = open_popup_key.defaultColumnSearch;
			if(selectedColumnSearch == null || selectedColumnSearch.length == 0) {
				selectedColumnSearch = $("select#selectOnId option:selected").val();
			}
			if(selectedColumnSearch && selectedColumnSearch.toLowerCase() === header[i].toLowerCase()){
				selectOptionHtml += "<option idx="+optionIdx+" value='"+header[i]+"' selected='selected'>"+header[i]+"</option>";
				optionIdx++;
			}else{
				selectOptionHtml += "<option idx="+optionIdx+" value='"+header[i]+"'>"+header[i]+"</option>";
				optionIdx++;
			}
		}
		
		popUpHeaderHtml += "</tr>";
		
	// looping data rows
	for(var rowIdx=1; rowIdx < listOfRows.length; rowIdx++) {
		var row = listOfRows[rowIdx];
		//first column
		popUpDataHtml += "<tr><td tabindex='-1' ondblclick='populateDataIntoParentTable_internal(this)'>"
			+"<img src='/rsunify/resources/imgs/arow-img.png' style='display: none;'>";
		
		//hidden column
		// index starting from 1 -- skipping row count column.
		for(var hiddenIdx=1; hiddenIdx < noOfHiddenColumnsFromFirst; hiddenIdx++) {
			popUpDataHtml += "<input type='hidden' value='"+row[hiddenIdx]+"'/>";
		}
		if(pagination_for_multi_selection_flag){
			pagination_for_multi_select_array_all_data.push(row);
			var mul_val = row[pagination_for_multi_select_compare_col_index];
			if(pagination_for_multi_select_checked_list.indexOf(mul_val) >= 0){
				popUpDataHtml += "<input data-value='"+mul_val+"' class='page_multi_select' checked type='checkbox'></td>";
			}else{
				popUpDataHtml += "<input  data-value='"+mul_val+"' class='page_multi_select' type='checkbox'></td>";
			}
			
			
		}else{
			popUpDataHtml += "</td>";
		}
		
		if(pagination_for_multi_selection_flag){
			if(open_popup_key.isFirstColumnEnable && open_popup_key.firstColumnIdx) {
				if(!tblAutoWidth){
					popUpDataHtml += "<td tabindex='-1' title='"+row[open_popup_key.firstColumnIdx]+"' class='rsPopup_cell'>"+row[open_popup_key.firstColumnIdx]+"</td>";
				}else{
					popUpDataHtml += "<td tabindex='-1' class='rsPopup_cell' >"+row[open_popup_key.firstColumnIdx]+"</td>";
				}
				
				// remove that first row from array
				row.splice(open_popup_key.firstColumnIdx,1);
			} 
				//data logic
				for(var columnIdx=noOfHiddenColumnsFromFirst; columnIdx < row.length; columnIdx++) {
							if(!tblAutoWidth){
								popUpDataHtml += "<td tabindex='-1' title='"+row[columnIdx]+"' class='rsPopup_cell' >"+row[columnIdx]+"</td>";
							}else{
								popUpDataHtml += "<td tabindex='-1' class='rsPopup_cell' >"+row[columnIdx]+"</td>";
							}
				}
			
			popUpDataHtml +="</tr>";
		}else{
			if(open_popup_key.isFirstColumnEnable && open_popup_key.firstColumnIdx) {
				if(!tblAutoWidth){
					popUpDataHtml += "<td tabindex='-1' title='"+row[open_popup_key.firstColumnIdx]+"' class='rsPopup_cell' ondblclick='populateDataIntoParentTable_internal(this)'>"+row[open_popup_key.firstColumnIdx]+"</td>";
				}else{
					popUpDataHtml += "<td tabindex='-1' class='rsPopup_cell' ondblclick='populateDataIntoParentTable_internal(this)'>"+row[open_popup_key.firstColumnIdx]+"</td>";
				}
				
				// remove that first row from array
				row.splice(open_popup_key.firstColumnIdx,1);
			} 
				//data logic
				for(var columnIdx=noOfHiddenColumnsFromFirst; columnIdx < row.length; columnIdx++) {
							if(!tblAutoWidth){
								popUpDataHtml += "<td tabindex='-1' title='"+row[columnIdx]+"' class='rsPopup_cell' ondblclick='populateDataIntoParentTable_internal(this)'>"+row[columnIdx]+"</td>";
							}else{
								popUpDataHtml += "<td tabindex='-1' class='rsPopup_cell' ondblclick='populateDataIntoParentTable_internal(this)'>"+row[columnIdx]+"</td>";
							}
				}
			
			popUpDataHtml +="</tr>";
		}
		
	}

	$('#selectOnId').html(selectOptionHtml);
	$('#pop-up-table thead').html(popUpHeaderHtml);
	$('#pop-up-table tbody').html(popUpDataHtml);
	// Displaying empty td if no record found.......
	if($('#pop-up-table tbody tr').length === 0 && !onLoad){
		popUpDataHtml = "<tr><td>"
			+"<img src='/rsunify/resources/imgs/arow-img.png'></td>";
		for(head = 1; head < $('#pop-up-table thead th').length ; head++){
			popUpDataHtml += "<td tabindex='-1' class='rsPopup_cell' ondblclick='populateDataIntoParentTable_internal(this)'></td>";
		}
		popUpDataHtml = popUpDataHtml+"</tr>";
		$('#pop-up-table tbody').html(popUpDataHtml);
	}
	$('#pop-up-table tbody td:eq(1)').addClass('active');
	$('#pop-up-table tbody td:eq(0)').find('img').show();
	$("#pagination-multi_select_checkbox-all_container").hide();
	if(pagination_for_multi_selection_flag)
	    $("#pagination-multi_select_checkbox-all_container").show();
	open_popup_key.defaultColumnSearch = null;
}

// Generic implementation of Scroll down functionality.
function populateScrollDownTableData(dataListArray){
	var popUpDataHtml = "";
	if(!freezeMaxCount){
		maxRowCount = dataListArray[1][0];
	}
	if(tblAutoWidth == true){
		$('#pop-up-table').attr('class',"tbl-fixed-headers-pagination "+attrIdVal+"");
	}else{
		$('#pop-up-table').attr('class',"tbl-fixed-headers-pagination "+attrIdVal+"");
	}
	var trCount = $('#pop-up-table tbody tr').length;
	/*$.each(dataListArray[0], function(id, dataArray){
		if(id != 0){
			for (var i = 1; i < dataArray.length; i++) {
				if(i == 1){
					popUpDataHtml += "<tr><td tabindex='-1' ondblclick='populateDataIntoParentTable_internal(this)'>"
						+"<img src='/rsunify/resources/imgs/arow-img.png' style='display: none;'>";
				}
				if(i < noOfHiddenColumnsFromFirst){
					popUpDataHtml += "<input type='hidden' value='"+dataArray[i]+"'/>";
				}else if(i >= noOfHiddenColumnsFromFirst){
					if(i == noOfHiddenColumnsFromFirst){
						popUpDataHtml += "</td>";
					}
					if(!tblAutoWidth){
						popUpDataHtml += "<td tabindex='-1' title='"+dataArray[i]+"' class='rsPopup_cell' ondblclick='populateDataIntoParentTable_internal(this)'>"+dataArray[i]+"</td>";
					}else{
						popUpDataHtml += "<td tabindex='-1' class='rsPopup_cell' ondblclick='populateDataIntoParentTable_internal(this)'>"+dataArray[i]+"</td>";
					}
				}
			}
			popUpDataHtml +="</tr>";
		}                         
	}); */
	
	var listOfRows = dataListArray[0];
	
	// looping data rows
	for(var rowIdx=1; rowIdx < listOfRows.length; rowIdx++) {
		var row = listOfRows[rowIdx];
		//first column
		popUpDataHtml += "<tr><td tabindex='-1' ondblclick='populateDataIntoParentTable_internal(this)'>"
			+"<img src='/rsunify/resources/imgs/arow-img.png' style='display: none;'>";
		
		//hidden column
		// index starting from 1 -- skipping row count column.
		for(var hiddenIdx=1; hiddenIdx < noOfHiddenColumnsFromFirst; hiddenIdx++) {
			popUpDataHtml += "<input type='hidden' value='"+row[hiddenIdx]+"'/>";
		}
		if(pagination_for_multi_selection_flag){
			//popUpDataHtml += "<input class='page_multi_select'  type='checkbox'></td>";
			pagination_for_multi_select_array_all_data.push(row);
			var mul_val = row[pagination_for_multi_select_compare_col_index];
			if(pagination_for_multi_select_checked_list.indexOf(mul_val) >= 0){
				popUpDataHtml += "<input data-value='"+mul_val+"' class='page_multi_select' checked type='checkbox'></td>";
			}else{
				popUpDataHtml += "<input  data-value='"+mul_val+"' class='page_multi_select' type='checkbox'></td>";
			}
		}else{
			popUpDataHtml += "</td>";
		}
		
		
		if(pagination_for_multi_selection_flag){
			if(open_popup_key.isFirstColumnEnable && open_popup_key.firstColumnIdx) {
				if(!tblAutoWidth){
					popUpDataHtml += "<td tabindex='-1' title='"+row[open_popup_key.firstColumnIdx]+"' class='rsPopup_cell' >"+row[open_popup_key.firstColumnIdx]+"</td>";
				}else{
					popUpDataHtml += "<td tabindex='-1' class='rsPopup_cell' >"+row[open_popup_key.firstColumnIdx]+"</td>";
				}
				
				// remove that first row from array
				row.splice(open_popup_key.firstColumnIdx,1);
			} 
				//data logic
				for(var columnIdx=noOfHiddenColumnsFromFirst; columnIdx < row.length; columnIdx++) {
							if(!tblAutoWidth){
								popUpDataHtml += "<td tabindex='-1' title='"+row[columnIdx]+"' class='rsPopup_cell' >"+row[columnIdx]+"</td>";
							}else{
								popUpDataHtml += "<td tabindex='-1' class='rsPopup_cell' >"+row[columnIdx]+"</td>";
							}
				}
				
				popUpDataHtml +="</tr>";
		}else{
			if(open_popup_key.isFirstColumnEnable && open_popup_key.firstColumnIdx) {
				if(!tblAutoWidth){
					popUpDataHtml += "<td tabindex='-1' title='"+row[open_popup_key.firstColumnIdx]+"' class='rsPopup_cell' ondblclick='populateDataIntoParentTable_internal(this)'>"+row[open_popup_key.firstColumnIdx]+"</td>";
				}else{
					popUpDataHtml += "<td tabindex='-1' class='rsPopup_cell' ondblclick='populateDataIntoParentTable_internal(this)'>"+row[open_popup_key.firstColumnIdx]+"</td>";
				}
				
				// remove that first row from array
				row.splice(open_popup_key.firstColumnIdx,1);
			} 
				//data logic
				for(var columnIdx=noOfHiddenColumnsFromFirst; columnIdx < row.length; columnIdx++) {
							if(!tblAutoWidth){
								popUpDataHtml += "<td tabindex='-1' title='"+row[columnIdx]+"' class='rsPopup_cell' ondblclick='populateDataIntoParentTable_internal(this)'>"+row[columnIdx]+"</td>";
							}else{
								popUpDataHtml += "<td tabindex='-1' class='rsPopup_cell' ondblclick='populateDataIntoParentTable_internal(this)'>"+row[columnIdx]+"</td>";
							}
				}
				
				popUpDataHtml +="</tr>";
		}
	
	}
	$('#pop-up-table tbody').append(popUpDataHtml);
	var iterator = 0;
	if(pageload == 1){
		for(var i = iterator; i < (iterator + pageCount); i++){                    
			$("#pop-up-table tbody tr:eq("+i+")").empty();
		}
		iterator = i;
	}
	//$('#pop-up-table tbody tr:eq('+trCount+') td:eq(1)').focus();
	//$('#pop-up-table tbody td:eq(0)').find('img').show();    
}

//Open pop-up screen on mouse click to get data in Json Array.
function popupJsonObjectValues(){
	if(addJsonObjValue == true){
		var selRow = $('#pop-up-table tbody tr td.active').parent('tr');
		popupJsonObj = [];
		var columnName = "";
		var columnValue = "";
		var headerCount = $('#pop-up-table th').length;
		var hiddenHeader = $('#pop-up-table thead th:eq(0) input').length;
		for(var i = 0; i < headerCount; i++){ 
			var popupItem = {};
			if(i == 0){
				for (var index = 0; index < hiddenHeader; index++) {
					columnName = $("#pop-up-table thead tr th:eq('"+i+"') input:eq('"+index+"')").val();
					columnValue = $.trim(selRow.find('td:eq('+i+') input:eq('+index+')').val());
					popupItem [columnName] = columnValue;
				}
			}else{
				columnName = $("#pop-up-table").find('thead tr th:eq('+(i)+')').text();
				columnValue = $.trim(selRow.find('td:eq('+i+')').text());
				popupItem [columnName] = columnValue;
			}
			popupJsonObj.push(popupItem);
		}
	}      
}

// 
function populateDataIntoParentTable_internal(columnObj) {
	if(open_popup_key.isFirstColumnEnable && !isNaN(open_popup_key.firstColumnIdx)) {
		var swapIndex = (open_popup_key.firstColumnIdx - noOfHiddenColumnsFromFirst) + 1;
		if(swapIndex > 1) {
		var columnIdx = $(columnObj).index();
		var rowObj = $(columnObj).parent('tr');
		var rowIndx = $(rowObj).index();
		var tableObj = $(rowObj).parent('tbody').parent('table');
		var dupTable = $(tableObj).clone();
		var dupRow = $(dupTable).find('tbody tr:eq('+rowIndx+')');
		var swapColumnHtml = $(rowObj).find('td:eq(1)').html();
		var noOfColumns = $(dupRow).find('td').length;
		for(var i=1; i<noOfColumns; i++) {
			if(i == swapIndex) {
				dupRow.find('td:eq('+swapIndex+')').html(swapColumnHtml);
				break;
			} else if(i > swapIndex) {
				break;
			} else {
				var nextHtml = $(rowObj).find('td:eq('+(i+1)+')').html();
				dupRow.find('td:eq('+i+')').html(nextHtml);
			}
		}
		/*var firstColumnHtml = $(rowObj).find('td:eq('+swapIndex+')').html();
		dupRow.find('td:eq('+swapIndex+')').html(swapColumnHtml);
		dupRow.find('td:eq(1)').html(firstColumnHtml);*/
		populateDataIntoParentTable(dupRow.find('td:eq('+columnIdx+')')[0]);
		} else {
			populateDataIntoParentTable(columnObj);
		}
	} else {
		populateDataIntoParentTable(columnObj);
	}
	pagination_for_multi_select_compare_col_index = 0;
	pagination_for_multi_select_checked_list = [];
	pagination_for_multi_select_array_all_data = [];
}

//Empty function need to write by user, based on screen functionality.
function populateDataIntoParentTable(currentObj){
	
}

// Added empty function which need to implement based on screen in respective screen.
function popupCloseEvent(elementId){
	
}

//Added empty function for no record found which need to implement based on screen in respective jsp
function popupNoRecordEvent(elementId){
       
}
$(document).on('click', '#open-pop-up-box #includeSearchCriteriaId', function(){
	$('#add-img-id').find('img').hide();
	$('#minus-img-id').find('img').show();
	var loopCount = $('#pop-up-table thead tr th').length;
	if(loopCount > 2){	
		$('#open-pop-up-box #add-search-fields-div').show();
		$('#add-input-sr-id').val('');
		var htmlOptions = '';
		for (var x = 1; x < loopCount; x++) {
			var colName = $.trim($('#pop-up-table thead tr th:eq('+x+')').text());
			var selectedColName = $.trim($('select#selectOnId option:selected').val());
			if(colName !== selectedColName)
				var selc = x == 2 ? "selected" : "";
				htmlOptions += '<option val="'+colName+'" '+selc+' >'+colName+'</option>';
		}
		$('#add-select-type-id option:eq(0)').prop('selected', true);
		$('#add-select-on-id').html(htmlOptions);
		$('#add-input-sr-id').focus();
	}
});
$(document).on('click', '#open-pop-up-box #excludeSearchCriteriaId', function(){
	$('#add-img-id').find('img').show();
	$('#minus-img-id').find('img').hide();
	$('#add-input-sr-id').val('');
	$('#add-select-type-id option:eq(0)').prop('selected', true);
	$('#open-pop-up-box #add-search-fields-div').hide();
	$('#inputSrId').focus();
	//added by jegadish.manoharan while hiding additional criteria
	callControllerOnSearchText();
});
function reloadAdditionSearchOption(){
	if(!$('#add-img-id').find('img').is(':visible') && $('#open-pop-up-box #add-search-fields-div').is(':visible')){
		var loopCount = $('#pop-up-table thead tr th').length;
		var htmlOptions = '';
		for (var x = 1; x < loopCount; x++) {
			var colName = $.trim($('#pop-up-table thead tr th:eq('+x+')').text());
			var selectedColName = $.trim($('select#selectOnId option:selected').val());
			if(colName !== selectedColName)
				htmlOptions += '<option val="'+colName+'">'+colName+'</option>';
		}
		$('#add-select-on-id').html(htmlOptions);
	}
}
$(document).on('contextmenu','#open-pop-up-box',function(e){
	e.preventDefault();
});

function callControllerOnPageUpDown(pageNumber){//1 or maxRowCount
	onLoad = false;
	scrlDown = false;
	pageload='0';
	var searchText = $(".inputSr").val();
	var searchOn = $( "select#selectOnId option:selected").val();
	freezeMaxCount = true;
	var targetJSON = getPaginationParams(getPaginationJasonParam(attrIdVal, "", pageNumber, searchOn, viewName));
	loadTableTdBody(pageNumber, targetJSON);
	return false;
}
function callScrolldownForPageUpDown(event, upDownFlag, table){
	blockKeyUp = true;
	var tBody = table.children("tbody");
	hotSearchRowNumberLength = tBody.children("tr").length;
	var activeColumn = table.find('td.active')
	var highlightedRow = activeColumn.parent('tr');
	var activeRowNumber = highlightedRow.index();
	var activeColNumber = activeColumn.index();
	activeColumn.removeClass('active');
	if(upDownFlag == 1){ //pageup
		activeRowNumber -= 18;
		activeRowNumber = (activeRowNumber < 0 ) ? 0 : activeRowNumber;
	} else {	//pagedown
		activeRowNumber += 18;
		activeRowNumber = (activeRowNumber >= hotSearchRowNumberLength ) ? (hotSearchRowNumberLength - 1 ) : activeRowNumber;
	}
	if($('#load-all-button').hasClass('countThousand')){
		pageCount=1000;
	}if(hotSearchRowNumberLength==200){
		$('#load-all-button').removeClass('countThousand');
		pageCount=200;
	}
	tBody.children("tr:eq("+activeRowNumber+")").children("td:eq("+activeColNumber+")").trigger("click");
	event.preventDefault();
	event.stopPropagation();	
}

// fetch column data using column name
function popupGetValveByColumnName(columnName, rowObj) {
	var columnIdx = -1;
	//
	$('#pop-up-table thead tr th').each(function() {
		if(columnName.toLowerCase() == $(this).text().toLowerCase()) {
			columnIdx = $(this).index();
			return false;
		}
	});
	
	if(columnIdx === -1) 
	{
		return '';
	}	
	
	return $(rowObj).find('td:eq('+columnIdx+')').text() || '';
}

function getPaginationJasonParam(attrIdVal, searchText, pageNumber, searchOn, viewName) {
	return {
		'attrIdVal': attrIdVal,
		'jasonParam': {
			"viewName" : viewName,
			"pageNumber" : pageNumber, 
			"pageSize" : pageCount,
			"columnToSearch"  : searchOn,
			"columnSearchText"  : searchText,
			"textSearchType" : $("select#selectTypeId option:selected").val()
		}
	};
}

function getSingleQuotedString(str) {
	return "'"+str+"'";
}

//opening pagination in product column key press event - start
$(document).on("keydown", ".open-popup-key", function(event){
	if(!$('#open-pop-up-box').is(':visible')) {
		var keyCode = (event.keyCode ? event.keyCode : event.which);
		var alpha_numeric_regex = /[a-zA-Z0-9]/;
		var charStr = String.fromCharCode(keyCode);
		  if( alpha_numeric_regex.test(charStr) ) {
			open_popup_key.charTyped = open_popup_key.charTyped + charStr.toLowerCase();
			console.log(open_popup_key.charTyped);
			if(!open_popup_key.isTriggered) {
				var popupDefaultColumnSearch = $(this).attr('open-popup-search-column');
				if(popupDefaultColumnSearch) {
					open_popup_key.defaultColumnSearch = popupDefaultColumnSearch;
				}
				open_popup_key.isTriggered = true;
				var that = this;
				open_popup_key.popupTrigger = setTimeout( function() {
					$('#open-pop-up-box').trigger("open-popup-key-typed", [that]);
				}, 500);
			}
			preventEventDefaults(event);
		}
	}
});

$(document).on("open-popup-key-typed", '#open-pop-up-box', function(event, triggerElement){
	if(open_popup_key.isTriggered) {
		$(".inputSr").val(open_popup_key.charTyped);
		$(triggerElement).trigger("dblclick");
		preventEventDefaults(event);
	}
});

$(document).on("open-pop-up-loaded", '#open-pop-up-box', function(event){
	if(open_popup_key.isTriggered && open_popup_key.charTyped.length >  0) {
		open_popup_key.charTyped = '';
		open_popup_key.isTriggered = false;
		if(open_popup_key.popupTrigger) {
			clearTimeout(open_popup_key.popupTrigger);
			open_popup_key.popupTrigger = null;
		}
		preventEventDefaults(event);
	}
});


//end
